<script type="text/javascript">
	"use strict";
	$(document).ready(function() {	
		loadSettings(false, false);
		loadPage();
		loadDailyPaths();
		loadIcons("main");
		loadAgonyDamage();
		var page = getSetting('homePage');
		$(this).find('a[href^=#tab-' + page + ']').tab('show');
		$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
			saveSetting('homePage', $(e.target).attr('href').split('-')[1]);
		});
	});
	
	function loadAgonyDamage() {
		$('.list-sub-fractal').each(function(){
			var scale = $(this).attr("data-scale");
			var type = $(this).attr("data-type");
			var resist = getSetting('agonyResist');
			if (type == "1")
				resist = getSetting('agonyResistAqua');
			var damage = getAgonyPerSecond(scale, resist);
			$(this).html(Math.round(100 * damage));
			// Boss fractals have unavoidable 10 seconds of agony (much more dangerous). / 2015-11-04 / Wethospu
			// No color: 1% or less damage.
			// Pale red: 5% or less damage, 3% for bosses.
			// Bright red: 10% or less damage, 5% for bosses.
			// Red: 20% or less damage, 10% for bosses.
			// Darker red: 33% or less damage, 10% for bosses.
			// Dark red: Rest.
			var parent = $(this).parent();
			if (type == "2") {
				if (damage > 0.15)
					$(parent).addClass('agony-6');
				else if (damage > 0.10)
					$(parent).addClass('agony-4');
				else if (damage > 0.5)
					$(parent).addClass('agony-3');
				else if (damage > 0.3)
					$(parent).addClass('agony-2');
				else if (damage > 0.01)
					$(parent).addClass('agony-1');
			}
			else {
				if (damage > 0.33)
					$(parent).addClass('agony-5');
				else if (damage > 0.2)
					$(parent).addClass('agony-4');
				else if (damage > 0.1)
					$(parent).addClass('agony-3');
				else if (damage > 0.5)
					$(parent).addClass('agony-2');
				else if (damage > 0.01)
					$(parent).addClass('agony-1');
			}
		});
	}
	
	function loadDailyPaths() {
		// Load tracking info.
		verifyDailyPaths();
		$(".tracker").each(function(){
			var path = $(this).attr("data-tag");
			if (settings.dailyPaths.indexOf(path) > -1)
				$(this).html('<img class="profession-icon" src="media/img/gold_star.png">');		
			else if (settings.donePaths.indexOf(path) > -1)
				$(this).html('<img class="profession-icon" src="media/img/silver_star.png">');
			else
				$(this).html('<img class="profession-icon" src="media/img/empty_star.png">');
		});
		// Clicking tracker should update the completion status.
		// Not completed -> Completed.
		// Completed before -> Completed.
		// Completed -> Not completed.
		$(".tracker").on('click',function(){
			var path = $(this).attr("data-tag");
			if (settings.dailyPaths.indexOf(path) > -1) {
				// Remove the path completely.
				settings.dailyPaths.splice( $.inArray(path, settings.dailyPaths), 1 );
				settings.donePaths.splice( $.inArray(path, settings.donePaths), 1 );
				$(this).html('<img class="profession-icon" src="media/img/empty_star.png">');
			}
			else if (settings.donePaths.indexOf(path) > -1) {
				// Add the path.
				settings.dailyPaths.push(path);
				$(this).html('<img class="profession-icon" src="media/img/gold_star.png">');		
			}
			else {
				// Add the path.
				settings.dailyPaths.push(path);
				settings.donePaths.push(path);
				$(this).html('<img class="profession-icon" src="media/img/gold_star.png">');		
			}
			saveSetting("dailyPaths", settings.dailyPaths);
			saveSetting("donePaths", settings.donePaths);
		});
	}
	
</script>
<div>
    <ul class="nav nav-tabs">
		<li><a href="#tab-fractals" data-toggle="tab">Fractals</a></li>
        <li><a href="#tab-raids" data-toggle="tab">Raids</a></li>
		<li><a href="#tab-dungeons" data-toggle="tab">Dungeons</a></li>
    </ul>

<div class="tab-content">
<div class="tab-pane" id="tab-fractals">
	<ul class="fractal-list">
ID_FRACTAL
</ul>
</div>
<div class="tab-pane" id="tab-raids">
<ul class="dungeon-list">
    <li>
        <img class="dungeon-image" src="http://wiki.guildwars2.com/images/4/47/Sabetha_the_Saboteur.png" alt="">
ID_VALE
    </li>
</ul>
</div>
<div class="tab-pane" id="tab-dungeons">
<ul class="dungeon-list">
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_ac.jpg" alt="">
ID_AC
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_cm.jpg" alt="">
ID_CM
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_ta.jpg" alt="">
ID_TA
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_se.jpg" alt="">
ID_SE
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_cof.jpg" alt="">
ID_COF
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_hotw.jpg" alt="">
ID_HOTW
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_coe.jpg" alt="">
ID_COE
    </li>
    <li>
        <img class="dungeon-image" src="./media/img/dungeon_arah.jpg" alt="">
ID_ARAH
    </li>
</ul>
</div>
</div>
</div>
